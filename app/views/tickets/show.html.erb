<% title @ticket.name %>

<div id="ticket">
  <p>
    The Ticket is <%= @ticket.state %> and has Priority <%= @ticket.priority %>. Responsible for this ticket is <%= @ticket.assignee ? @ticket.assignee_name : 'nobody' %>.
  </p>

  <p>
    Created by <%= @ticket.user_name %> <%= time_ago_in_words @ticket.created_at %> ago (<%= time @ticket.created_at %>) in Category <%= @ticket.category_name_with_ancestors %>.
  </p>

  <h2>Description</h2>
  <p>
    <%= textilize @ticket.description %>
  </p>

  <% unless @ticket.solution.blank? %>
    <h3>Solution</h3>
    <p>
      <%=h @ticket.solution %>
    </p>
  <% end %>
  
  <h3>Pages</h3>
  <p>
    <ul>
      <%= render :partial => @ticket.pages.recent.published %>
    </ul>
  </p>
  
  <p>
    <%= link_to "Add a page", new_ticket_page_path(@ticket) %> to this ticket
  </p>

  <% if @visit %>
    <p>
      You visited this ticket <%= @visit.count %> times.
    </p>
  
    <p>
      You were here <%= time_ago_in_words @visit.updated_at %> ago. (<%= time @visit.updated_at %>)
    </p>
  <% end %>
  
  <p>
    Last updated <%= time_ago_in_words @ticket.updated_at %> ago. (<%= time @ticket.updated_at %>)
  </p>
  
  <p>
    <% if @watch %>
      You are watching this ticket. <%= link_to "Unwatch", @watch, :confirm => 'Are you sure?', :method => :delete %>
    <% else %>
      <%= link_to "Watch this Ticket", ticket_watches_path(@ticket), :method => :post %>
    <% end %>
  </p>
  
  <h2>Comments</h2>
  <div id="comments">
    <%= render :partial => @ticket.comments.recent %>
    <%= render :partial => 'comments/form' %>    
  </div>

  <div class="actions">
    <p>
      <%= link_to "Back", tickets_path %> |
      <%= link_to "Edit", edit_ticket_path(@ticket) %> |
      <%= link_to "Archive", archive_ticket_path(@ticket), :confirm => 'Are you sure?', :method => :put %> |
      <%= link_to "Destroy", @ticket, :confirm => 'Are you sure?', :method => :delete %>
    </p>
  </div>
</div>